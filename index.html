<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šå¿«é€’è¿½è¸ªç³»ç»Ÿ</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --shadow: 8px 8px 15px #d9d9d9, 
                     -8px -8px 15px #ffffff;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-color);
            min-height: 100vh;
            margin: 0;
            padding: 30px;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .express-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .express-card:hover {
            transform: translateY(-5px);
        }

        .loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <h1 style="text-align:center;margin-bottom:40px;">ğŸ“¦ å¤šå¿«é€’è¿½è¸ªçœ‹æ¿</h1>
    <div class="container" id="expressContainer">
        <!-- å¿«é€’å¡ç‰‡åŠ¨æ€åŠ è½½ -->
    </div>

    <script src="js/md5.min.js"></script>
    <script>
        // å¿«é€’é…ç½®åˆ—è¡¨ï¼ˆæŒ‰éœ€ä¿®æ”¹ï¼‰
        const expressList = [
            {
                name: "é›€å·¢æµ“ç¼©å’–å•¡æ¶²ç”Ÿæ¤°æ‹¿é“",
                number: "777299594611897",
                company: "shentong"
            },
            {
                name: "åœ†é€šå¿«é€’",
                number: "YT7539474022893",
                company: "yuantong"
            },
            {
                name: "åœ†é€šå¿«é€’",
                number: "YT8754665430595",
                company: "yuantong"
            },
            {
                name: "åœ†é€šå¿«é€’",
                number: "YT7539474022893",
                company: "yuantong"
            }
        ];

        // APIé…ç½®
        const apiConfig = {
            customer: "84A1FB5B991BFF3E4AA9F2CD7945FD7A",
            key: "ymillNNw9500"
        };

        // ç”Ÿæˆå¡ç‰‡æ¨¡æ¿
        function createCardTemplate(express) {
            return `
                <div class="express-card" id="${express.number}">
                    <h3>${express.name}</h3>
                    <p>å•å·ï¼š${express.number}</p>
                    <div class="timeline">
                        <div class="loading" style="height:80px; border-radius:8px;margin-top:15px;"></div>
                    </div>
                </div>
            `;
        }

        // åˆå§‹åŒ–å®¹å™¨
        function initContainer() {
            const container = document.getElementById('expressContainer');
            expressList.forEach(express => {
                container.innerHTML += createCardTemplate(express);
            });
        }

        // æ‰¹é‡æŸ¥è¯¢ç‰©æµ
        async function batchQuery() {
            expressList.forEach(async (express) => {
                try {
                    const param = JSON.stringify({
                        com: express.company,
                        num: express.number
                    });
                    
                    const sign = md5(param + apiConfig.key + apiConfig.customer).toUpperCase();
                    
                    const response = await fetch('https://poll.kuaidi100.com/poll/query.do', {
                        method: 'POST',
                        mode: 'no-cors'
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: new URLSearchParams({
                            customer: apiConfig.customer,
                            sign: sign,
                            param: param
                        })
                    });
                    
                    const data = await response.json();
                    updateCard(express.number, data);
                } catch (error) {
                    updateCard(express.number, { 
                        message: "æŸ¥è¯¢å¤±è´¥ï¼š" + error.message 
                    });
                }
            });
        }

        // æ›´æ–°å¡ç‰‡å†…å®¹
        function updateCard(expressNumber, data) {
            const card = document.getElementById(expressNumber);
            if (!data.result) {
                card.querySelector('.timeline').innerHTML = `
                    <div class="error" style="color:#ff4444;padding:10px;">
                        ${data.message || 'æ•°æ®è·å–å¤±è´¥'}
                    </div>`;
                return;
            }

            let html = `
                <div class="status-header">
                    <p>çŠ¶æ€ï¼š<span style="color:${getStatusColor(data.state)}">
                        ${getStatusText(data.state)}
                    </span></p>
                </div>
                <div class="timeline">`;

            data.data.slice(0, 3).forEach(item => { // æ˜¾ç¤ºæœ€æ–°3æ¡
                html += `
                    <div class="timeline-item">
                        <div class="status-indicator" 
                             style="background:${getStatusColor(data.state)}"></div>
                        <p><small>${item.time}</small></p>
                        <p>${item.context}</p>
                    </div>`;
            });

            html += `</div>`;
            card.querySelector('.timeline').innerHTML = html;
        }

        // çŠ¶æ€å¤„ç†å‡½æ•°
        function getStatusText(state) {
            switch (state) {
                case '0':
                    return 'åœ¨é€”';
                case '2':
                    return 'æ½ä»¶';
                case '3':
                    return 'ç–‘éš¾';
                case '4':
                    return 'ç­¾æ”¶';
                case '5':
                    return 'é€€ç­¾';
                case '6':
                    return 'æ´¾ä»¶';
                case '7':
                    return 'é€€å›';
                default:
                    return 'æœªçŸ¥';
            }
        }

        function getStatusColor(state) {
            switch (state) {
                case '0':
                case '2':
                case '6':
                    return '#4caf50'; // ç»¿è‰²
                case '3':
                case '7':
                    return '#ff9800'; // æ©™è‰²
                case '4':
                    return '#2196f3'; // è“è‰²
                case '5':
                    return '#f44336'; // çº¢è‰²
                default:
                    return '#9e9e9e'; // ç°è‰²
            }
        }

        // åˆå§‹åŒ–æ‰§è¡Œ
        initContainer();
        batchQuery();
        
        // å®šæ—¶åˆ·æ–°ï¼ˆæ¯5åˆ†é’Ÿï¼‰
        setInterval(batchQuery, 300000);
    </script>
</body>
</html>
